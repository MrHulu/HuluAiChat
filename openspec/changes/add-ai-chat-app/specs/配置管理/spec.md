# 配置管理

## 新增需求

### 需求：配置管理

系统应提供类似 Cursor 的配置方式：用户可自定义 Provider 列表（含 name、base_url、api_key、model_id 等），配置持久化到本地文件（如 JSON 或 YAML），应用启动时加载、修改后保存，且 API Key 等敏感信息仅存于本地。

#### 场景：读取与应用配置

- **当** 应用启动
- **那么** 从约定路径加载配置文件（若不存在则使用默认或空配置）
- **并且** 已保存的 Provider 列表与当前选中的模型被正确恢复，供多模型接入与切换使用

#### 场景：编辑并保存配置

- **当** 用户在设置界面中新增、修改或删除 Provider（名称、Base URL、API Key、Model ID）
- **那么** 变更可被保存到同一配置文件
- **并且** 保存后无需重启应用即可在模型列表与当前模型中生效（或明确提示“部分设置需重启生效”）

#### 场景：设置页主题（第一项、下拉+图标）

- **当** 用户打开设置界面
- **那么** 第一项为主题设置，使用**下拉框**选择（明亮 / 暗夜）
- **并且** 下拉选项为**文字 + 图标**（如「☀️ 明亮」「🌙 暗夜」），图标使用 CustomTkinter 小图或 emoji，且**随当前主题变色**（与当前亮/暗主题一致）

#### 场景：新增 Provider 的草稿与校验

- **当** 用户点击「新增 Provider」
- **那么** 新行以**草稿状态**展示（与已保存项视觉区分），不显示「删除」按钮，主按钮为「确定」
- **并且** 名称、Base URL、Model ID、API Key 满足严格校验规则前「确定」置灰不可点；校验通过后点击「确定」则退出草稿、按钮变为「设为当前」并显示「删除」

#### 场景：Model ID 预设与 Custom

- **当** 用户编辑某 Provider 的 Model ID
- **那么** 可从小程序支持的**预设模型 ID 列表**中选择（含 OpenAI、DeepSeek、通义、Kimi、智谱、Claude 等常见 id；不含百川、零一万物等未纳入的厂商）
- **并且** 提供「Custom」选项；选择 Custom 时显示自定义输入框，并对输入做非空与格式校验

#### 场景：配置与数据位置

- **当** 应用在 Windows、Linux 或 macOS 上运行
- **那么** 配置文件存放在该平台合适的用户配置或数据目录
- **并且** 路径可抽象为跨平台实现，便于与对话持久化等共用“应用数据根目录”逻辑

#### 场景：敏感信息

- **当** 配置中包含 API Key 等敏感字段
- **那么** 仅存储在用户本机配置文件中，不上传、不记录到日志或错误报告中
- **并且** 若未来支持“显示/隐藏”密钥，界面默认不明文展示完整 Key
