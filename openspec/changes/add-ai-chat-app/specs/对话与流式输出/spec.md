# 对话与流式输出

## 新增需求

### 需求：对话与流式输出

系统应支持用户输入消息并发送给当前选中的 AI 模型，以流式方式接收回复并在界面中实时逐字（或逐 token）展示，形成连贯的对话体验。

#### 场景：用户发送消息并收到流式回复

- **当** 用户输入文本并触发发送（如点击发送或回车）
- **那么** 消息作为用户角色加入当前会话，并请求当前选中模型的 API
- **并且** 模型返回的回复以流式（如 SSE/chunk）方式接收，界面持续追加内容，呈现打字机效果

#### 场景：发送中与错误

- **当** 请求已发出、回复尚未收齐
- **那么** 界面显示进行中状态（如加载指示或“正在输入”），且用户可区分“用户消息已发出”与“AI 正在回复”
- **并且** 若 API 报错或网络失败，界面展示可理解的错误信息，且不将失败内容记为成功回复

#### 场景：对话上下文

- **当** 用户在当前会话中连续多轮发送消息
- **那么** 请求 API 时携带该会话内已有的用户与助手消息作为上下文（在模型与 API 允许的范围内）
- **并且** 流式输出仅追加当前这一条助手回复，不重放历史消息
