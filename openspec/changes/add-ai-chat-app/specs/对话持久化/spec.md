# 对话持久化

## 新增需求

### 需求：对话持久化

系统应使用本地 SQLite 数据库持久化会话与消息，支持为当前会话保存消息、加载历史会话列表、按会话加载历史消息，并在应用重启后保留这些数据。

#### 场景：保存对话消息

- **当** 用户发送消息或收到 AI 回复
- **那么** 该条消息（含角色、内容、时间等必要字段）写入本地 SQLite
- **并且** 消息与当前会话关联；若为新建会话，先创建会话再写入消息

#### 场景：加载会话列表与历史消息

- **当** 用户打开应用或进入会话列表
- **那么** 从 SQLite 读取会话列表（如标题、创建时间、最后活动时间），并展示给用户
- **并且** 当用户选择某一会话时，从 SQLite 加载该会话下的所有消息并按顺序展示

#### 场景：新建会话

- **当** 用户发起“新建会话”操作
- **那么** 在本地创建新会话记录，并清空当前对话展示区域
- **并且** 后续消息归属该新会话，直至用户再次新建或切换会话

#### 场景：数据位置与跨平台

- **当** 应用在 Windows、Linux 或 macOS 上运行
- **那么** SQLite 文件存放在该平台合适的用户数据目录（如可配置或遵循平台惯例）
- **并且** 不依赖应用进程当前工作目录，以便打包为 exe 后仍能正确读写数据库
